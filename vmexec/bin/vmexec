#!/usr/bin/env ruby
require 'optparse'
require_relative '../lib/vm_exec'

class Cli
  def run
    options, args = parse_options

    domain = args[0]
    cmd = args[1..]

    status, out, err = VmExec::GaExec.run(domain, cmd)

    unless options[:quiet]
      puts out if out
      warn err if err
    end

    exit(status)
  end

  protected

  def parse_options
    options = {
      quiet: false
    }

    parser = OptionParser.new do |opts|
      opts.banner = "Usage: #{$0} [options] <domain> [--] <command...>"

      opts.on('-q', '--quiet', 'Suppress output') do
        options[:quiet] = true
      end
    end

    args = parser.parse!

    if ARGV.length < 2
      warn parser
      exit(false)
    end

    [options, args]
  end
end

vmexec = Cli.new
vmexec.run
